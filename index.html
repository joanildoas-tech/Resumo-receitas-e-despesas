
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dashboard de Gastos</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<style>
body { background:#f4f6f9; }

.card-custom {
    text-align:center;
    padding:10px 15px;
    border-radius:15px;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

.bg-orange { background-color: #FF7F50 !important; color: white !important; }

.table-container {
    border-radius:15px;
    background:white;
    padding:15px;
    width:100%;
}

.table-scroll { max-height:460px; overflow-y:auto; }

.table thead th {
    position: sticky;
    top: 0;
    background-color:#D9EEF9 !important;
    color:#2C3E50 !important;
    z-index: 2;
}

.grafico-box {
    background:white;
    border-radius:20px;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
    padding:15px;
    width:100%;
}

.container-custom {
    max-width: 1700px;
    padding-left: 15px;
    padding-right: 15px;
    margin: 0 auto;
}
</style>
</head>
<body>

<div class="container-custom py-3">
<h1 class="text-center mb-4">Proventos e Gastos Pessoais</h1>

<div class="row mb-4">
<div class="col-12 col-md-4">
<label class="form-label">Selecione o Mês:</label>
<select id="mesSelect" class="form-select" onchange="atualizar()">
<option value="Todos" >Todos</option><option value="01/2026" >01/2026</option><option value="02/2026" >02/2026</option><option value="03/2026" selected>03/2026</option><option value="04/2026" >04/2026</option><option value="05/2026" >05/2026</option><option value="06/2026" >06/2026</option><option value="07/2026" >07/2026</option><option value="08/2026" >08/2026</option><option value="09/2026" >09/2026</option><option value="10/2026" >10/2026</option><option value="11/2026" >11/2026</option><option value="12/2026" >12/2026</option>
</select>
</div>
</div>

<div class="row g-3 mb-4 justify-content-center" id="rowCards"></div>

<div class="row g-3 mb-4">
<div class="col-12 col-md-6">
<div class="grafico-box">
<h5 class="text-center mb-3">Gastos por Categoria</h5>
<div id="grafico_categoria"></div>
</div>
</div>

<div class="col-12 col-md-6">
<div class="table-container">
<h5 class="text-center mb-3">Transações</h5>
<div class="table-scroll">
<table class="table table-striped table-hover" id="tabela_transacoes"></table>
</div>
</div>
</div>

<div class="row g-3 mb-4">
<div class="col-12 col-md-6">
<div class="table-container">
<h5 class="text-center mb-3">Gastos por categoria</h5>
<table class="table table-striped" id="tabela_categoria"></table>
</div>
</div>

<div class="col-12 col-md-6">
<div class="table-container">
<h5 class="text-center mb-3">Gastos por forma de pagamento</h5>
<table class="table table-striped" id="tabela_pagamento"></table>
</div>
</div>
</div>

<div class="row g-3 mb-4" id="rowMensal" style="display:none;">
<div class="col-12">
<div class="grafico-box">
<div id="grafico_mensal"></div>
</div>
</div>
</div>

</div>

<script>

let df = [];
let tabela1 = [];
let tabela2 = [];
let tabela3 = [];
let tabela4 = [];

async function carregarDados() {

    const url1 = "https://docs.google.com/spreadsheets/d/1JTq0hJwFfMZY5mDsFy0DuEOcOgXSK_b2WylTybB8bWk/export?format=csv";
    const url2 = "https://docs.google.com/spreadsheets/d/1JTq0hJwFfMZY5mDsFy0DuEOcOgXSK_b2WylTybB8bWk/export?format=csv&gid=918439659";

    // =========================
    // ABA PRINCIPAL (GASTOS)
    // =========================
    const resp1 = await fetch(url1);
    const texto1 = await resp1.text();
    df = processarGastos(texto1);

    // =========================
    // ABA PROVENTOS / DESCONTOS
    // =========================
    const resp2 = await fetch(url2);
    const texto2 = await resp2.text();
    processarProventos(texto2);

    atualizar();
}

function processarGastos(texto){

    const linhas = texto.split("\n").filter(l => l.trim() !== "");
    const cab = linhas[0].split(",");

    return linhas.slice(1).map(linha => {

        const col = linha.split(",");
        let obj = {};

        cab.forEach((c,i)=> obj[c.trim()] = col[i]);

        // Converter valor
        obj["Valor"] = parseFloat(
            obj["Valor"]
                ?.replace("R$","")
                ?.replace(/\./g,"")
                ?.replace(",",".")
        ) || 0;

        // Converter datas
        if(obj["Data de pagamento"]){
            let partes = obj["Data de pagamento"].split("/");
            obj["Mês"] = partes[1] + "/" + partes[2];
        }

        return obj;
    });
}

function processarProventos(texto){

    const linhas = texto.split("\n").filter(l => l.trim() !== "");

    // Ignorar primeira linha (header=1 do Python)
    const dados = linhas.slice(1).map(l => l.split(","));

    function limparTabela(inicio){
        return dados.map(l => {

            let data = l[inicio];
            let tipo = l[inicio+1];
            let valor = l[inicio+2];

            if(!data || !valor) return null;

            valor = parseFloat(
                valor
                    ?.replace("R$","")
                    ?.replace(/\./g,"")
                    ?.replace(",",".")
            ) || 0;

            let partes = data.split("/");
            let mes = partes[1] + "/" + partes[2];

            return {
                Data: data,
                Tipo: tipo,
                Valor: valor,
                Mês: mes
            };

        }).filter(x => x !== null);
    }

    tabela1 = limparTabela(0);   // Proventos Joanildo
    tabela2 = limparTabela(5);   // Descontos Joanildo
    tabela3 = limparTabela(10);  // Proventos Keila
    tabela4 = limparTabela(15);  // Descontos Keila
}

function moeda(v){
    return Number(v).toLocaleString('pt-BR',{
        style:'currency',
        currency:'BRL'
    });
}

carregarDados();

</script>
</body>
</html>


